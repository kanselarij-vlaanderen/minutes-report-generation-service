import { MinutesContext, Secretary } from "./app";
import { formatDate } from "./utils";
import { MEETING_KINDS } from "./config";
import * as fs from "fs";

const sectionSeparator = `<div class="separator">
  <svg
    style="align-self: center; margin: 0 auto; margin-top: 4rem"
    viewBox="0 0 100 30"
    width="100"
    height="30"
    xmlns="http://www.w3.org/2000/svg"
  >
  <path class="c"
       d="m 7.4231259,6.1581725 1.61,-1.544 a 32.25,32.25 0 0 1 4.3250001,-3.69999997 5.374,5.374 0 0 1 2.913,-0.91400000128 5.487,5.487 0 0 1 3.727,1.41999997128 4.245,4.245 0 0 1 1.619,3.262 3.285,3.285 0 0 1 -0.789,2.225 2.442,2.442 0 0 1 -1.917,0.913 3.736,3.736 0 0 1 -2.773,-1.528 3.923,3.923 0 0 0 0.6,0.067 3.525,3.525 0 0 0 2.358,-0.847 2.544,2.544 0 0 0 1,-1.992 1.742,1.742 0 0 0 -0.523,-1.262 1.7,1.7 0 0 0 -1.254,-0.531 q -1.892,0 -6.474,4.731 l -1.328,1.378 a 15.04,15.04 0 0 0 4.283,1.86 17.505,17.505 0 0 0 4.8,0.8000005 8.619,8.619 0 0 0 6,-2.1830005 7.049,7.049 0 0 0 2.416,-5.454 5.291,5.291 0 0 0 -0.183,-1.411 q 3.5,0.613 3.5,3.088 0,3.122 -3.246,5.42 a 12.907,12.907 0 0 1 -7.661,2.3000005 20.094,20.094 0 0 1 -6.79,-1.693 l 1.212,1.179 a 20.748,20.748 0 0 0 3.81,2.963 6.766,6.766 0 0 0 3.129,1.187 2.385,2.385 0 0 0 1.577,-0.539 1.658,1.658 0 0 0 0.648,-1.32 3.114,3.114 0 0 0 -0.05,-0.482 q 2.29,0.864 2.291,2.225 a 1.906,1.906 0 0 1 -0.963,1.6 4.024,4.024 0 0 1 -2.324,0.656 q -3.187,0 -9.33,-6.01 l -1.162,-1.145 A 23.6,23.6 0 0 0 9.6781259,8.5441725 q -2.822,2.8890005 -5.677,2.8890005 a 4.442,4.442 0 0 1 -2.847,-0.913 2.792,2.792 0 0 1 -1.15400003106,-2.2750005 2.721,2.721 0 0 1 1.09500003106,-2.208 4.265,4.265 0 0 1 2.756,-0.879 7.7,7.7 0 0 1 3.572,1 z m -0.864,0.763 a 7.415,7.415 0 0 0 -2.423,-0.531 3.543,3.543 0 0 0 -1.769,0.349 1.151,1.151 0 0 0 -0.589,1.062 0.85,0.85 0 0 0 0.357,0.747 1.841,1.841 0 0 0 1.054,0.249 5.08,5.08 0 0 0 3.37,-1.876 z"
       id="path2" />
</svg></div>`;

function renderLogo() {
  return `
    <div class="logo">
      <svg
        style="align-self: center; margin: 0 auto;"
        viewBox="0 0 141.8 65.2"
        width="141.8"
        height="65.2"
        xmlns="http://www.w3.org/2000/svg"
      >
        <style>
          .st0 {
            fill: #373636;
          }
        </style>
        <path
          class="st0"
          d="m68.842 13.341-5 14.4h-2.9l-5-14.4h2.7l3.8 11 3.7-11z"
        />
        <path class="st0" d="m71.142 12.141 2.2-.2h.4v15.6h-2.6z" />
        <path
          class="st0"
          d="M85.542 27.741c-.4 0-.8-.1-1.3-.2-.4-.2-.8-.5-1.3-.9-.4.3-.8.6-1.3.8-.5.2-1 .3-1.7.3-.5 0-1.1-.1-1.6-.3-.6-.2-1.1-.5-1.4-1-.4-.5-.6-1.3-.6-2.3 0-1 .2-1.8.8-2.3.6-.5 1.6-.8 3.1-.8.6 0 1.3 0 2.3.1v-.6c0-.8-.2-1.3-.6-1.6-.4-.3-.9-.5-1.5-.5-.5 0-1 .1-1.5.2s-1 .3-1.5.5l-.6-2.2c1.2-.6 2.7-.9 4.1-.9 1.1 0 2.1.2 2.9.8.8.6 1.2 1.5 1.2 2.9v4.2c0 .5.2.9.5 1.2.3.3.7.4 1.2.5l-1.2 2.1Zm-3-4.7c-1.2 0-2.1 0-2.7.1-.6.1-1 .5-1 1.1 0 .9.7 1.4 1.6 1.4.3 0 .8-.1 1.3-.3.5-.3.8-.8.8-1.7v-.6Z"
        />
        <path
          class="st0"
          d="M97.242 27.741c-.4 0-.8-.1-1.2-.2-.4-.2-.8-.5-1.3-.9-.4.3-.8.6-1.3.8-.5.2-1 .3-1.7.3-.5 0-1.1-.1-1.6-.3-.6-.2-1.1-.5-1.4-1-.4-.5-.6-1.3-.6-2.3 0-1 .2-1.8.8-2.3.6-.5 1.6-.8 3.1-.8.6 0 1.3 0 2.3.1v-.6c0-.8-.2-1.3-.6-1.6-.4-.3-.9-.5-1.5-.5-.5 0-1 .1-1.5.2s-1 .3-1.5.5l-.6-2.2c1.2-.6 2.7-.9 4.1-.9 1.1 0 2.1.2 2.9.8.8.6 1.2 1.5 1.2 2.9v4.2c0 .5.2.9.5 1.2.3.3.7.4 1.2.5l-1.3 2.1Zm-3-4.7c-1.2 0-2.1 0-2.7.1-.6.1-1 .5-1 1.1 0 .9.7 1.4 1.6 1.4.3 0 .8-.1 1.3-.3.5-.3.8-.8.8-1.7v-.6Z"
        />
        <path
          class="st0"
          d="M100.442 16.341h2.1l.2.8c.9-.6 1.9-1 3-1s2.1.4 2.7 1.3c1-.9 2.2-1.3 3.4-1.3.9 0 1.8.3 2.5.9.6.6 1.1 1.6 1.1 3v7.4h-2.5v-6.7c0-.8-.2-1.4-.6-1.7-.4-.3-.8-.5-1.3-.5-.6 0-1.3.2-1.9.6 0 .3.1.6.1.9v7.5h-2.5v-6.7c0-.8-.2-1.4-.5-1.7-.3-.3-.8-.5-1.3-.5-.6 0-1.3.2-1.9.6v8.3h-2.5v-11.2Z"
        />
        <path
          class="st0"
          d="M117.742 24.641c.4.1.8.3 1.3.5s1 .3 1.5.3c.4 0 .9-.1 1.3-.3.3-.2.6-.5.6-1s-.3-.9-.7-1.1c-.2-.1-.5-.2-.8-.3-.6-.2-1.2-.4-1.7-.6-.6-.3-1-.7-1.3-1.3-.1-.3-.2-.7-.2-1.2 0-1.2.5-2 1.2-2.6.7-.5 1.7-.8 2.7-.8.9 0 1.8.2 2.5.4v2.3l-.1.1c-.6-.3-1.2-.5-1.9-.5-.5 0-.9.1-1.2.2-.3.2-.5.4-.5.8s.3.6.7.9c.2.1.5.2.7.3.6.2 1.1.4 1.7.7.6.3 1 .8 1.3 1.5.1.3.2.8.2 1.2 0 1.3-.5 2.2-1.3 2.8-.8.6-1.9.9-3 .9s-2.1-.3-2.9-.8v-2.4Z"
        />
        <path
          class="st0"
          d="M135.842 24.641v2.4c-.5.2-1 .4-1.6.5-.6.1-1.1.2-1.6.2-1.6 0-3-.5-4-1.4-1.1-1-1.7-2.4-1.7-4.4 0-1.9.6-3.3 1.6-4.3.9-1 2.2-1.5 3.5-1.5.4 0 1 0 1.6.3.7.2 1.4.7 1.9 1.4s.9 1.8.9 3.4v1.7h-6.8c.2.9.7 1.5 1.3 1.9.6.4 1.3.6 2 .6 1-.1 2-.4 2.9-.8Zm-1.7-3.7c-.1-.8-.3-1.4-.7-1.8-.4-.4-.9-.5-1.4-.5-.5 0-1 .2-1.5.5-.4.4-.8 1-.9 1.8h4.5Z"
        />
        <path
          class="st0"
          d="M57.142 48.241v-14.2h4.1c.9 0 2 .1 2.9.4.9.3 1.8.8 2.4 1.6.6.8 1 1.8 1 3.1 0 1-.2 1.8-.7 2.5-.4.7-1 1.2-1.8 1.6.3.6.9 1.4 1.5 2 .7.7 1.4 1.2 2.1 1.4v.1l-1.1 1.7c-.7 0-1.4-.3-2.1-.8-.7-.5-1.3-1.1-1.8-1.8s-.9-1.4-1.1-1.9c-.5.1-.9.1-1.4.1h-1.6v4.2h-2.4Zm2.5-11.8v5.1h1.6c1.5 0 2.4-.2 3-.7.6-.4.8-1 .8-1.8s-.2-1.4-.8-1.9c-.6-.5-1.5-.7-3-.7h-1.6Z"
        />
        <path
          class="st0"
          d="M79.342 45.341v2.4c-.5.2-1 .4-1.6.5-.6.1-1.1.2-1.6.2-1.6 0-3-.5-4-1.4-1.1-1-1.7-2.4-1.7-4.4 0-1.9.6-3.3 1.6-4.3.9-1 2.2-1.5 3.5-1.5.4 0 1 0 1.6.3.7.2 1.4.7 1.9 1.4s.9 1.8.9 3.4v1.7h-6.8c.2.9.7 1.5 1.3 1.9.6.4 1.3.6 2 .6.9-.1 1.9-.4 2.9-.8Zm-1.8-3.8c-.1-.8-.3-1.4-.7-1.8-.4-.4-.9-.5-1.4-.5-.5 0-1 .2-1.5.6-.4.4-.8 1-.9 1.8h4.5Z"
        />
        <path
          class="st0"
          d="m91.942 38.141-.1.2c-.6.1-1.2.3-1.9.7.2.4.3.9.3 1.4 0 1.1-.4 2-1.2 2.8-.7.7-1.8 1.2-3 1.2-.5 0-.9-.1-1.3-.2-.2.2-.2.4-.2.6 0 .5.5.8 1.3.8h1.3c1.5 0 2.7.4 3.4 1 .7.6 1.1 1.5 1.1 2.4 0 1.2-.7 2.3-1.8 3.1-1.1.8-2.5 1.3-3.9 1.3-1.3 0-2.3-.4-3-1-.7-.6-1.1-1.5-1.1-2.5 0-.9.5-2 1.3-2.8-.3-.2-.5-.5-.7-.8-.2-.3-.2-.7-.2-1 0-.6.3-1.3.8-2-.3-.3-.5-.7-.7-1.2-.2-.5-.2-1-.2-1.4 0-1.1.4-2 1.2-2.7.7-.7 1.8-1.1 3-1.1.8 0 1.6.2 2.2.5.5-.4 1-.6 1.5-.8.5-.2 1-.3 1.3-.3l.6 1.8Zm-6.9 9.7c-.4.5-.7 1-.7 1.5 0 .4.2.8.5 1.1.3.3.9.4 1.5.4.8 0 1.4-.2 1.9-.6.5-.3.8-.8.8-1.2 0-.6-.3-.9-.8-1.1-.5-.2-1.2-.2-2-.2h-1.2Zm1.1-8.8c-.6 0-1 .2-1.3.5-.3.3-.5.7-.5 1.1 0 .4.2.8.5 1.1.3.3.7.5 1.3.5.6 0 1-.2 1.3-.5.3-.3.4-.7.4-1.1 0-.4-.1-.8-.4-1.1-.3-.3-.7-.5-1.3-.5"
        />
        <path
          class="st0"
          d="M101.442 45.341v2.4c-.5.2-1 .4-1.6.5-.6.1-1.1.2-1.6.2-1.6 0-3-.5-4-1.4-1.1-1-1.7-2.4-1.7-4.4 0-1.9.6-3.3 1.6-4.3.9-1 2.2-1.5 3.5-1.5.4 0 1 0 1.6.3.7.2 1.4.7 1.9 1.4s.9 1.8.9 3.4v1.7h-6.8c.2.9.7 1.5 1.3 1.9.6.4 1.3.6 2 .6.9-.1 1.9-.4 2.9-.8Zm-1.7-3.8c-.1-.8-.3-1.4-.7-1.8-.4-.4-.9-.5-1.4-.5-.5 0-1 .2-1.5.6-.4.4-.8 1-.9 1.8h4.5Z"
        />
        <path
          class="st0"
          d="M111.142 39.841c-.6-.4-1.3-.6-1.9-.6-.8 0-1.6.3-2.3.8v8.1h-2.5v-11.2h2.1l.3.9c.8-.7 1.7-1.1 2.8-1.1.3 0 .7 0 1.1.1.4.1.8.2 1.1.3l-.7 2.7Z"
        />
        <path
          class="st0"
          d="M113.642 34.041c0-.4.2-.8.4-1 .3-.3.6-.4 1.1-.4.5 0 .8.2 1.1.4.3.3.4.6.4 1s-.2.8-.4 1c-.3.3-.6.4-1.1.4-.5 0-.8-.2-1.1-.4-.3-.2-.4-.5-.4-1m.2 3h2.5v11.2h-2.5v-11.2Z"
        />
        <path
          class="st0"
          d="M119.342 37.041h2.1l.2.9c1-.7 2.3-1.1 3.6-1.1 1.1 0 2.1.3 2.8.9.7.6 1.2 1.6 1.2 3v7.4h-2.5v-6.7c0-.8-.3-1.4-.8-1.8-.5-.4-1.1-.5-1.8-.5-.9 0-1.7.3-2.4.7v8.3h-2.5v-11.1Z"
        />
        <path
          class="st0"
          d="m141.842 38.141-.1.2c-.6.1-1.2.3-1.9.7.2.4.3.9.3 1.4 0 1.1-.4 2-1.2 2.8-.7.7-1.8 1.2-3 1.2-.5 0-.9-.1-1.3-.2-.2.2-.2.4-.2.6 0 .5.5.8 1.2.8h1.3c1.5 0 2.7.4 3.4 1 .7.6 1.1 1.5 1.1 2.4 0 1.2-.7 2.3-1.8 3.1-1.1.8-2.5 1.3-3.9 1.3-1.3 0-2.3-.4-3-1-.7-.6-1.1-1.5-1.1-2.5 0-.9.5-2 1.3-2.8-.3-.2-.5-.5-.7-.8-.2-.3-.2-.7-.2-1 0-.6.3-1.3.8-2-.3-.3-.5-.7-.7-1.2-.1-.5-.2-1-.2-1.4 0-1.1.4-2 1.2-2.7.7-.7 1.8-1.1 3-1.1.8 0 1.6.2 2.2.5.5-.4 1-.6 1.5-.8.5-.2 1-.3 1.3-.3l.7 1.8Zm-6.9 9.7c-.4.5-.7 1-.7 1.5 0 .4.2.8.5 1.1.3.3.9.4 1.5.4.8 0 1.4-.2 1.9-.6.5-.3.8-.8.8-1.2 0-.6-.3-.9-.8-1.1-.5-.2-1.2-.2-2-.2h-1.2Zm1.1-8.8c-.6 0-1 .2-1.3.5-.3.3-.5.7-.5 1.1 0 .4.2.8.5 1.1.3.3.7.5 1.3.5.6 0 1-.2 1.3-.5.3-.3.4-.7.4-1.1 0-.4-.1-.8-.4-1.1-.3-.3-.7-.5-1.3-.5"
        />
        <path class="st0" d="M29.09.098 29.372 0 51.93 65.104l-.284.098z" />
        <path
          class="st0"
          d="M30.042 31.841c-1.7-1.3-2.4 0-3.5-.1-.9-.1-1.7-1.5-2.4-1.2-1.3.7.5 3 1.3 3.5.7.4 1.6.8 1.8.9 1.1.5 1.5 1.2 1.6 2.4 0 .3 0 .9-.1 1.2-.5 2-4 3.9-6.1 2.5-1-.7-1.8-1.5-2.2-3-.6-2.7-2.5-4.6-3.1-7.3-.4-1.6-.7-3.3-1.1-4.9-.4-1.7-.9-3.3-1.2-4.8-.3-1.4-1-3.5-1.5-4.8-2-5.1-2.8-4.7-2.8-4.7s.7 1.4 3.3 13.9c.1.5 1 6 1.7 7.8.2.7.7 2 1 2.7.8 1.8 3 4.5 3.1 7 .1 1.4.2 2.6.3 3.7 0 .3.2 1.6.4 2.2.5 1.5 4.8 6.3 9.4 6.3v-3.7c-4.5 0-8.8-2.5-8.9-2.8-.1-.1.2-1.8.5-2.6.6-1.5 1.7-2.8 3.7-3 2.2-.2 3.5.5 4.7.5l.1-11.7Z"
        />
        <path
          class="st0"
          d="M10.442 18.541c-.2 2.7-4.4 6.5-5.7 8.9-.7 1.2-1.4 3.2-1.7 4.4-.6 3.3.2 5.3.9 7.2 1.4 3.4-.2 4.6.9 3.9 1.4-1.1 1.2-3.7 1-5.3-.1-1.3-.2-2.8 0-4.3.4-2.9 2.1-6 3.6-8.2 2-2.7 1.3-5.4 1-6.6"
        />
        <path
          class="st0"
          d="M11.242 26.341s.5 2.2-1.5 7.7c-5 14.6 4.6 16 7.3 19.4 0 0 1.1-1.5-3.3-6.2-1.6-1.7-3-5.6-1.8-11 1.9-8-.7-9.9-.7-9.9"
        />
        <path
          class="st0"
          d="M1.842 16.741c-.2-.9-.3-1.6-.2-2.3.2-3.4 3.3-4.8 4.1-5.3 0 0 1.4-1 1.6-1.9 0 0 1.4 3.6-1.9 5.7-1.7 1-2.8 2.2-3.6 3.8"
        />
        <path
          class="st0"
          d="M9.642 13.441c.2.3 1.5 2.2-3.8 6.6-5.3 4.4-3.6 7.5-3.6 7.5s-5.6-3.1.9-8.5 5.2-6.5 5.2-6.5.8-.1 1.3.9"
        />
        <path
          class="st0"
          d="M16.542 15.141c.9.1 1.5 3 3.6 3.6 1.6.5 3.2.2 3.6 1.1-.7.4-.1 1.6.6 1.4.5-1.6.8-8.1-7.8-6.1m2.8 1.3c.1-.2.2 0 .4-.2s.5-.6.9-.7c.3-.1.7 0 .9.1.2 0 .1.5-.1.6-.3.2-1.1-.1-1.1.5 0 1 1.4 0 2.1 0 .5 2.4-3.7 1.7-3.1-.3"
        />
      </svg>
    </div>
  `;
}

function renderHeader(context: MinutesContext) {
  const { plannedStart, numberRepresentation, kind, kindLabel } = context;
  let title = `<p class="header-text">
    NOTULEN VAN DE ${kindLabel.replace(/Ministerraad/i, 'vergadering').toUpperCase()} VAN ${formatDate(plannedStart)}
  </p>`;
  if (kind === MEETING_KINDS.ELECTRONIC_PROCEDURE) {
    title = `<p class="header-text">
      NOTULEN VAN ${formatDate(plannedStart)}<br/><br/>
      ${kindLabel.replace(/Procedure/i, 'Ministerraad').toUpperCase()}
    </p>`;
  } else if (kind === MEETING_KINDS.PVV) {
    title = `<p class="header-text">
      NOTULEN VAN ${formatDate(plannedStart)}<br/><br/>
      ${kindLabel.replace('Ministerraad - ', '').toUpperCase()}
    </p>`;
  }
  return `
    <div>
      ${renderLogo()}
      <div>
        <p>${numberRepresentation}</p>
        ${title}
      </div>
    </div>
  `;
}

export function createStyleHeader() {
  const styles = fs.readFileSync("/app/report-style.css").toString();
  return `
    <head>
      <style>
        ${styles}
      </style>
    </head>
  `;
}

export function renderMinutes(
  part: string,
  context: MinutesContext,
  secretary: Secretary | undefined
) {
  let minutesHtml = ` ${renderHeader(context)}
    <div>${part}</div>`;
  minutesHtml = minutesHtml.replace('<section data-section="announcements"',
      `${sectionSeparator}
      <section data-section="announcements"`
  ).replace('<p><span id="next-meeting">',
    `${sectionSeparator}
    <p><span id="next-meeting">`
  );
  if (secretary && secretary.person) {
    minutesHtml += `
      <div class="signature">
        <h3 style="font-weight: 500;">
          ${secretary.person.firstName}
          ${secretary.person.lastName.toUpperCase()},
        </h3>
        <p>${secretary.title}.</p>
      </div>
    `;
  }
  return minutesHtml;
}
